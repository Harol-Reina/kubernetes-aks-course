# =============================================================================
# EJEMPLO: Configuración de Kubeconfig con Múltiples Contextos
# =============================================================================
# Descripción:
#   Este archivo muestra cómo configurar múltiples contextos en kubeconfig
#   para gestionar fácilmente diferentes:
#   - Clústeres
#   - Usuarios
#   - Namespaces por defecto
#
# Ubicación típica: ~/.kube/config
#
# ⚠️ NOTA: Este es un ejemplo educativo. NO contiene credenciales reales.
#          En producción, usar certificados y tokens válidos.
#
# Uso:
#   # Ver este archivo (no aplicarlo con kubectl)
#   cat kubeconfig-example.yaml
#
#   # Para usar (reemplazar ~/.kube/config):
#   cp kubeconfig-example.yaml ~/.kube/config
#
#   # O especificar archivo custom:
#   export KUBECONFIG=./kubeconfig-example.yaml
#   kubectl config view
# =============================================================================

apiVersion: v1
kind: Config

# =============================================================================
# CLUSTERS: Define los clústeres de Kubernetes disponibles
# =============================================================================
clusters:

# Clúster de desarrollo local (minikube/kind)
- cluster:
    # URL del API server
    server: https://127.0.0.1:6443
    
    # Certificado CA del clúster (validar servidor)
    certificate-authority-data: LS0tLS1CRUdJTi... (base64)
    # O ruta al archivo:
    # certificate-authority: /path/to/ca.crt
    
  name: local-dev

# Clúster de staging (remoto)
- cluster:
    server: https://staging-k8s.example.com:6443
    certificate-authority-data: LS0tLS1CRUdJTi... (base64)
    
  name: staging-cluster

# Clúster de producción (remoto)
- cluster:
    server: https://prod-k8s.example.com:6443
    certificate-authority-data: LS0tLS1CRUdJTi... (base64)
    
    # TLS server name override (si DNS difiere)
    # tls-server-name: kubernetes.example.com
    
  name: production-cluster

# Clúster en región EU (para GDPR)
- cluster:
    server: https://eu-k8s.example.com:6443
    certificate-authority-data: LS0tLS1CRUdJTi... (base64)
    
  name: eu-cluster

# =============================================================================
# USERS: Define los usuarios y sus credenciales
# =============================================================================
users:

# Usuario administrador local
- name: local-admin
  user:
    # Autenticación con certificado cliente
    client-certificate-data: LS0tLS1CRUdJTi... (base64)
    client-key-data: LS0tLS1CRUdJTi... (base64)
    # O rutas a archivos:
    # client-certificate: /path/to/admin.crt
    # client-key: /path/to/admin.key

# Usuario developer (permisos limitados)
- name: developer
  user:
    # Autenticación con token
    token: eyJhbGciOiJSUzI1NiIsImtpZCI6Ij... (JWT token)

# Usuario staging (Service Account)
- name: staging-user
  user:
    # Token de Service Account
    token: eyJhbGciOiJSUzI1NiIsImtpZCI6Ij...

# Usuario producción (certificado con expiración)
- name: prod-admin
  user:
    client-certificate-data: LS0tLS1CRUdJTi...
    client-key-data: LS0tLS1CRUdJTi...

# Usuario con exec plugin (ejemplo: AWS EKS, GKE)
- name: cloud-user
  user:
    exec:
      apiVersion: client.authentication.k8s.io/v1beta1
      command: aws
      args:
      - eks
      - get-token
      - --cluster-name
      - my-cluster
      # Ejemplo para GKE:
      # command: gke-gcloud-auth-plugin
      # args: []

# =============================================================================
# CONTEXTS: Combinación de cluster + user + namespace
# =============================================================================
contexts:

# Contexto para desarrollo local (namespace: default)
- context:
    cluster: local-dev
    user: local-admin
    namespace: default
  name: local

# Contexto para desarrollo local (namespace: development)
- context:
    cluster: local-dev
    user: local-admin
    namespace: development
  name: local-dev

# Contexto para desarrollo local (namespace: staging local)
- context:
    cluster: local-dev
    user: local-admin
    namespace: staging
  name: local-staging

# Contexto para desarrollo remoto
- context:
    cluster: staging-cluster
    user: developer
    namespace: development
  name: remote-dev

# Contexto para staging remoto
- context:
    cluster: staging-cluster
    user: staging-user
    namespace: staging
  name: staging

# Contexto para producción (namespace: production)
- context:
    cluster: production-cluster
    user: prod-admin
    namespace: production
  name: production

# Contexto para producción (namespace: monitoring)
- context:
    cluster: production-cluster
    user: prod-admin
    namespace: monitoring
  name: prod-monitoring

# Contexto para clúster EU
- context:
    cluster: eu-cluster
    user: prod-admin
    namespace: production
  name: eu-production

# =============================================================================
# CURRENT-CONTEXT: Contexto activo por defecto
# =============================================================================
current-context: local-dev

# =============================================================================
# PREFERENCES: Configuración adicional
# =============================================================================
preferences:
  colors: true  # Colorear salida (si el cliente lo soporta)

# =============================================================================
# COMANDOS PARA GESTIONAR CONTEXTOS
# =============================================================================
#
# 1. VER CONFIGURACIÓN ACTUAL:
#    kubectl config view
#    kubectl config view --minify  # Solo el contexto actual
#
# 2. LISTAR CONTEXTOS:
#    kubectl config get-contexts
#
# 3. VER CONTEXTO ACTUAL:
#    kubectl config current-context
#
# 4. CAMBIAR DE CONTEXTO:
#    kubectl config use-context production
#    kubectl config use-context local-dev
#
# 5. CREAR NUEVO CONTEXTO:
#    kubectl config set-context my-context \
#      --cluster=local-dev \
#      --user=developer \
#      --namespace=development
#
# 6. MODIFICAR CONTEXTO EXISTENTE:
#    # Cambiar namespace del contexto actual
#    kubectl config set-context --current --namespace=production
#
#    # Cambiar namespace de un contexto específico
#    kubectl config set-context staging --namespace=new-namespace
#
# 7. ELIMINAR CONTEXTO:
#    kubectl config delete-context old-context
#
# 8. AGREGAR CLUSTER:
#    kubectl config set-cluster new-cluster \
#      --server=https://new-cluster.example.com:6443 \
#      --certificate-authority=/path/to/ca.crt
#
# 9. AGREGAR USER:
#    kubectl config set-credentials new-user \
#      --client-certificate=/path/to/client.crt \
#      --client-key=/path/to/client.key
#
# 10. RENOMBRAR CONTEXTO:
#     kubectl config rename-context old-name new-name
#
# 11. VER SOLO NAMESPACES:
#     kubectl config view --minify | grep namespace:
#
# 12. USAR KUBECONFIG TEMPORAL (sin modificar ~/.kube/config):
#     export KUBECONFIG=/path/to/custom-config.yaml
#     kubectl config view
#
# 13. FUSIONAR MÚLTIPLES KUBECONFIGS:
#     export KUBECONFIG=config1.yaml:config2.yaml:config3.yaml
#     kubectl config view --flatten > merged-config.yaml
#
# =============================================================================
# HERRAMIENTAS ÚTILES
# =============================================================================
#
# 1. KUBECTX / KUBENS:
#    # Instalar
#    brew install kubectx
#
#    # Uso
#    kubectx                # Listar contextos
#    kubectx production     # Cambiar a contexto 'production'
#    kubectx -              # Volver al contexto anterior
#
#    kubens                 # Listar namespaces del contexto actual
#    kubens staging         # Cambiar a namespace 'staging'
#    kubens -               # Volver al namespace anterior
#
# 2. K9S:
#    # Cliente interactivo con soporte visual de contextos/namespaces
#    brew install k9s
#    k9s
#
# 3. LENS:
#    # IDE visual para Kubernetes con gestión de contextos
#    https://k8slens.dev
#
# =============================================================================
# SEGURIDAD
# =============================================================================
#
# ⚠️ IMPORTANTE:
#
# 1. PERMISOS DE ARCHIVO:
#    chmod 600 ~/.kube/config  # Solo lectura/escritura para el usuario
#
# 2. NO COMMITEAR KUBECONFIG EN GIT:
#    echo ".kube/config" >> .gitignore
#    echo "kubeconfig*.yaml" >> .gitignore
#
# 3. ROTAR CREDENCIALES REGULARMENTE:
#    - Certificados: Expiración automática (típicamente 1 año)
#    - Tokens: Rotar cada 90 días
#    - Service Accounts: Usar tokens de corta duración
#
# 4. USAR DIFERENTES USUARIOS POR ENTORNO:
#    NO usar el mismo usuario admin para dev, staging y producción
#
# 5. LEAST PRIVILEGE:
#    Usuarios deben tener SOLO los permisos necesarios (RBAC)
#
# 6. AUDITAR ACCESO:
#    Habilitar audit logging en el API server
#
# =============================================================================
# EJEMPLO DE USO TÍPICO
# =============================================================================
#
# Flujo de trabajo diario de un developer:
#
# # 1. Trabajar en desarrollo local
# kubectx local-dev
# kubectl get pods
# kubectl logs my-pod
#
# # 2. Cambiar a staging remoto para verificar
# kubectx staging
# kubectl get pods
# kubectl describe pod problematic-pod
#
# # 3. Cambiar a namespace de monitoring (mismo clúster staging)
# kubens monitoring
# kubectl get pods  # Ahora lista pods de 'monitoring' en staging
#
# # 4. Volver a namespace anterior
# kubens -
#
# # 5. Cambiar a producción (con precaución)
# kubectx production
# kubectl get pods --watch
#
# # 6. Volver a contexto anterior
# kubectx -
#
# =============================================================================
